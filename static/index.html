<!DOCTYPE html>
<html>
<head>
    <title>å¤šæˆ¿é—´èŠå¤©å®¤</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* æš—å¤œæ¨¡å¼æ ·å¼ */
        body.dark-mode {
            background-color: #121212;
            color: #ffffff;
        }
        .dark-mode .tab, .dark-mode .tab-content, .dark-mode .input-group {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        .dark-mode .message{
            background-color: #121212;
            color: #ffffff;
        }


        .dark-mode .message-header .username, .dark-mode .message-header .timestamp {
            color: #ffffff;
        }
        .dark-mode .message-content {
            color: #ffffff;
        }


        /* å°çª—å£æ ·å¼ */
        #chatFloatWindow {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            height: 400px;
            background-color: #ffffff;
            border: 1px solid #ccc;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow: hidden;
        }
        #chatFloatWindow .header {
            background-color: #f1f1f1;
            padding: 10px;
            cursor: move;
        }

        #chatFloatWindow .input-group {
            display: flex;
            padding: 10px;
        }
        #chatFloatWindow .input-group input {
            flex: 1;
            padding: 5px;
        }
        #chatFloatWindow .input-group button {
            padding: 5px 10px;
            margin-left: 5px;
        }
        #messageInput {
            border: 1px solid #ccc;
            padding: 5px;
            min-height: 50px;
            overflow-y: auto;
            outline: none;
        }
    </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    let ws;
    let currentRoom = null;
    let messageQueue = []; // æ¶ˆæ¯é˜Ÿåˆ—

    // æ˜¾ç¤ºé€‰é¡¹å¡
    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));

        document.getElementById(tabName + 'Tab').classList.add('active');
        document.querySelector(`button[onclick="showTab('${tabName}')"]`).classList.add('active');
    }

    function showLoading() {
        document.getElementById('loading').classList.remove('hidden');
    }

    function hideLoading() {
        document.getElementById('loading').classList.add('hidden');
    }

    // ä¿®æ”¹åçš„åˆ›å»ºæˆ¿é—´å‡½æ•°
    async function createRoom() {
        showLoading();
        try {
            await initWebSocket();
            const username = document.getElementById('usernameCreate').value.trim() || 'åŒ¿åç”¨æˆ·';
            const password = document.getElementById('roomPassword').value;

            ws.send(JSON.stringify({
                type: 'create_room',
                username: username,
                password: password
            }));

        } catch (error) {
            Swal.fire('é”™è¯¯', 'è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
        } finally {
            hideLoading();
        }
    }

    // ä¿®æ”¹åçš„åŠ å…¥æˆ¿é—´å‡½æ•°
    async function joinRoom() {
        const roomId = document.getElementById('roomId').value.trim();
        const password = document.getElementById('joinPassword').value;
        const username = document.getElementById('usernameJoin').value.trim() || 'åŒ¿åç”¨æˆ·';

        try {
            await initWebSocket(); // ç­‰å¾…è¿æ¥å»ºç«‹

            ws.send(JSON.stringify({
                type: 'join_room',
                room_id: roomId,
                password: password,
                username: username
            }));

        } catch (error) {
            Swal.fire('é”™è¯¯', 'è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
        }
    }

    // åˆå§‹åŒ–WebSocketï¼ˆä¼˜åŒ–ç‰ˆï¼‰
    function initWebSocket() {
        return new Promise((resolve, reject) => {
            if (ws && ws.readyState === WebSocket.OPEN) {
                resolve();
                return;
            }

            ws = new WebSocket('wss://' + window.location.host + '/ws');

            ws.onopen = () => {
                while (messageQueue.length > 0) {
                    const msg = messageQueue.shift();
                    ws.send(JSON.stringify(msg));
                }
                resolve();
            };

            ws.onmessage = (event) => {
                const msg = JSON.parse(event.data);
                switch (msg.type) {
                    case 'system':
                        handleSystemMessage(msg.content);
                        break;
                    case 'message':
                        appendMessage(msg);
                        break;
                    case 'room_info':
                        document.getElementById('currentRoom').textContent = msg.room_id;
                        break;
                    case 'error':
                        Swal.fire('é”™è¯¯', msg.error, 'error');
                        break;
                    case 'show_chat_panel':
                        document.getElementById('roomPanel').classList.add('hidden');
                        document.getElementById('chatPanel').classList.remove('hidden');
                        break;
                    case 'show_room_panel':
                        resetUI();
                        break;
                    case 'user_id': // æ–°å¢å¤„ç† userId çš„æ¶ˆæ¯ç±»å‹
                        ws.userId = msg.userId; // ä¿å­˜ userId åˆ° ws å¯¹è±¡
                        break;
                    case 'history': // æ–°å¢å¤„ç†å†å²æ¶ˆæ¯çš„ç±»å‹
                        msg.messages.forEach(appendMessage); // å°†å†å²æ¶ˆæ¯æ˜¾ç¤ºåœ¨èŠå¤©ç•Œé¢ä¸­
                        break;
                }
            };

            ws.onerror = (error) => {
                reject(error);
            };
        });
    }

    // å¤„ç†ç³»ç»Ÿæ¶ˆæ¯
    function handleSystemMessage(content) {
        if (content.startsWith('æˆ¿é—´åˆ›å»ºæˆåŠŸ')) {
            currentRoom = content.split('ID: ')[1];
            document.getElementById('currentRoom').textContent = currentRoom;
            appendSystemMessage(`æ‚¨å·²åˆ›å»ºæˆ¿é—´ ${currentRoom}`);
        } else if (content.startsWith('æˆåŠŸåŠ å…¥æˆ¿é—´')) {
            currentRoom = content.split(' ')[1]; // å‡è®¾æ¶ˆæ¯æ ¼å¼ä¸º "æˆåŠŸåŠ å…¥æˆ¿é—´ <room_id>"
            document.getElementById('currentRoom').textContent = currentRoom;
            document.getElementById('roomPanel').classList.add('hidden');
            document.getElementById('chatPanel').classList.remove('hidden');
            ws.send(JSON.stringify({
                type: 'get_users',
                room_id: currentRoom
            }));
        }else if (content.startsWith('å½“å‰æˆ¿é—´ç”¨æˆ·:')){
            document.getElementById('currentUsers').textContent = content.split(': ')[1];
            return
        }
        appendSystemMessage(content);
    }

    // ä¿®æ”¹åçš„å‘é€æ¶ˆæ¯å‡½æ•°
    function sendMessage() {
        const input = document.getElementById('messageInput');
        const contentParts = [];

        // æ”¶é›†æ‰€æœ‰å›¾ç‰‡é¢„è§ˆ
        const previews = input.querySelectorAll('img');
        previews.forEach(img => {
            contentParts.push(`<img src="${img.src}" alt="ç²˜è´´çš„å›¾ç‰‡" style="max-width: 100%;">`);
        });

        // æ·»åŠ æ–‡æœ¬å†…å®¹ï¼Œè¿‡æ»¤æ‰ img æ ‡ç­¾
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = input.innerHTML;
        Array.from(tempDiv.querySelectorAll('img')).forEach(img => img.remove()); // åˆ é™¤ img æ ‡ç­¾
        const textContent = tempDiv.innerHTML.trim();
        if (textContent) {
            contentParts.push(textContent);
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰å†…å®¹åˆ™ä¸å‘é€
        if (contentParts.length === 0) return; // ä»…åœ¨æ²¡æœ‰å†…å®¹æ—¶è¿”å›

        const message = {
            type: 'message',
            content: contentParts.join(' '), // åˆå¹¶æ–‡æœ¬å’Œå›¾ç‰‡
            from: document.getElementById('usernameCreate').value.trim() || document.getElementById('usernameJoin').value.trim(),
            userId: ws.userId,
            timestamp: new Date().toLocaleTimeString()
        };

        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify(message));
        } else {
            messageQueue.push(message);
            if (!ws || ws.readyState === WebSocket.CLOSED) {
                initWebSocket().catch(() => {
                    Swal.fire('é”™è¯¯', 'æ­£åœ¨å°è¯•é‡æ–°è¿æ¥...', 'info');
                });
            }
        }

        // æ¸…ç©ºè¾“å…¥æ¡†å’Œé¢„è§ˆ
        while (input.firstChild) {
            input.removeChild(input.firstChild);
        }
    }

    function sendMessageFromFloat() {
        const input = document.getElementById('floatMessageInput');
        const contentParts = [];

        // æ”¶é›†æ‰€æœ‰å›¾ç‰‡é¢„è§ˆ
        const previews = input.querySelectorAll('img');
        previews.forEach(img => {
            contentParts.push(`<img src="${img.src}" alt="ç²˜è´´çš„å›¾ç‰‡" style="max-width: 100%;">`);
        });

        // æ·»åŠ æ–‡æœ¬å†…å®¹ï¼Œè¿‡æ»¤æ‰ img æ ‡ç­¾
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = input.innerHTML;
        Array.from(tempDiv.querySelectorAll('img')).forEach(img => img.remove()); // åˆ é™¤ img æ ‡ç­¾
        const textContent = tempDiv.innerHTML.trim();
        if (textContent) {
            contentParts.push(textContent);
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰å†…å®¹åˆ™ä¸å‘é€
        if (contentParts.length === 0) return; // ä»…åœ¨æ²¡æœ‰å†…å®¹æ—¶è¿”å›

        const message = {
            type: 'message',
            content: contentParts.join(' '), // åˆå¹¶æ–‡æœ¬å’Œå›¾ç‰‡
            from: document.getElementById('usernameCreate').value.trim() || document.getElementById('usernameJoin').value.trim(),
            userId: ws.userId,
            timestamp: new Date().toLocaleTimeString()
        };

        if (ws && ws.readyState === WebSocket.OPEN) {
            ws.send(JSON.stringify(message));
        } else {
            messageQueue.push(message);
            if (!ws || ws.readyState === WebSocket.CLOSED) {
                initWebSocket().catch(() => {
                    Swal.fire('é”™è¯¯', 'æ­£åœ¨å°è¯•é‡æ–°è¿æ¥...', 'info');
                });
            }
        }

        // æ¸…ç©ºè¾“å…¥æ¡†å’Œé¢„è§ˆ
        while (input.firstChild) {
            input.removeChild(input.firstChild);
        }
    }

    // ç¦»å¼€æˆ¿é—´
    function leaveRoom() {
        ws.send(JSON.stringify({ type: 'leave_room' }));
        ws.close();
        resetUI();
        if (document.body.classList.contains('dark-mode')) {
            document.body.classList.remove('dark-mode');
        }
        closeChatFloatWindow(); // å…³é—­æµ®çª—
    }

    // é‡ç½®ç•Œé¢
    function resetUI() {
        currentRoom = null;
        document.getElementById('chatPanel').classList.add('hidden');
        document.getElementById('roomPanel').classList.remove('hidden');
        document.getElementById('messages').innerHTML = '';
    }

    // æ¶ˆæ¯å¤„ç†
    function appendMessage(msg) {
        const messages = document.getElementById('messages');
        const div = document.createElement('div');

        const currentUserId = ws.userId;
        const isMe = msg.userId === currentUserId;

        div.className = `message ${isMe ? 'my-message' : 'other-message'}`;

        div.innerHTML = `
<div class="message-header">
  <span class="username">${msg.from}</span>
  <span class="timestamp">${msg.timestamp}</span>
</div>
<div class="message-content">${msg.content}</div>
`;

        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;

        // å°çª—å£æ˜¾ç¤ºæ¶ˆæ¯
        const floatWindowMessages = document.getElementById('chatFloatWindow').querySelector('.messages');
        floatWindowMessages.appendChild(div.cloneNode(true));
        floatWindowMessages.scrollTop = floatWindowMessages.scrollHeight;
    }

    function appendSystemMessage(content) {
        const messages = document.getElementById('messages');
        const div = document.createElement('div');
        div.className = 'message system';
        div.textContent = content;
        messages.appendChild(div);
        messages.scrollTop = messages.scrollHeight;
    }

    // é”®ç›˜äº‹ä»¶
    function handleKeyPress(e) {
        if (e.key === 'Enter') {
            if (e.ctrlKey) {
                // å…è®¸æ¢è¡Œ
                return;
            } else {
                e.preventDefault();
                if (document.getElementById('roomPanel').classList.contains('hidden')) {
                    // æ£€æŸ¥æµ®åŠ¨çª—å£æ˜¯å¦æ˜¾ç¤º
                    if (document.getElementById('chatFloatWindow').style.display === 'block') {
                        sendMessageFromFloat();
                    } else {
                        sendMessage();
                    }
                }
            }
        }
    }

    // æ˜¾ç¤ºè¡¨æƒ…é¢æ¿
    function showEmojisPanel() {
        const emojisPanel = document.getElementById('emojisPanel');
        emojisPanel.classList.remove('hidden');
    }

    // æ’å…¥è¡¨æƒ…åˆ°æ¶ˆæ¯è¾“å…¥æ¡†
    function insertEmoji(emoji) {
        const input = document.getElementById('messageInput');
        input.value += emoji;
        input.focus();
    }

    // ç‚¹å‡»å…¶ä»–åœ°æ–¹è‡ªåŠ¨æ”¶èµ·è¡¨æƒ…é¢æ¿
    document.addEventListener('click', function(event) {
        const emojisPanel = document.getElementById('emojisPanel');
        const emojisButton = document.querySelector('button[onclick="showEmojisPanel()"]');
        if (!emojisPanel.contains(event.target) && event.target !== emojisButton) {
            emojisPanel.classList.add('hidden');
        }
    });

    // ä¿®æ”¹è¾“å…¥æ¡†æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
    document.querySelector('button[onclick="showTab(\'emojis\')"]').setAttribute('onclick', 'showEmojisPanel()');

    // åˆ‡æ¢æš—å¤œæ¨¡å¼
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        const darkModeButton = document.getElementById('darkModeButton');
        if (document.body.classList.contains('dark-mode')) {
            darkModeButton.textContent = 'ç™½å¤©æ¨¡å¼';
        } else {
            darkModeButton.textContent = 'é»‘å¤œæ¨¡å¼';
        }
    }

    // æ·»åŠ æ¨¡æ€æ¡†ç›¸å…³ä»£ç 
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <span class="close">&times;</span>
            <img class="modal-content" id="modalImg">
        `;
        document.body.appendChild(modal);

        const img = modal.querySelector('.modal-content');
        const span = modal.querySelector('.close');

        span.onclick = function() {
            modal.style.display = 'none';
        }

        modal.onclick = function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }


    });

    // ä¿®æ”¹ç²˜è´´äº‹ä»¶å¤„ç†é€»è¾‘
    document.getElementById('messageInput').addEventListener('paste', function(e) {
        const items = e.clipboardData.items;
        let imageFound = false;

        for (let i = 0; i < items.length; i++) {
            if (items[i].type.indexOf('image') !== -1) {
                imageFound = true;
                const blob = items[i].getAsFile();
                if (!blob) {
                    Swal.fire('é”™è¯¯', 'æ— æ³•è·å–ç²˜è´´çš„å›¾ç‰‡', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = function() {
                        // é™åˆ¶å›¾ç‰‡æœ€å¤§å®½åº¦ä¸º300px
                        const maxWidth = 300;
                        const maxHeight = 300;
                        let width = img.width;
                        let height = img.height;

                        if (width > maxWidth) {
                            const scale = maxWidth / width;
                            width = maxWidth;
                            height = height * scale;
                        }

                        if (height > maxHeight) {
                            const scale = maxHeight / height;
                            width = width * scale;
                            height = maxHeight;
                        }

                        const canvas = document.createElement('canvas');
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        const resizedDataUrl = canvas.toDataURL('image/png');

                        // æ’å…¥å›¾ç‰‡åˆ°è¾“å…¥æ¡†
                        const input = document.getElementById('messageInput');
                        const imgPreview = document.createElement('img');
                        imgPreview.src = resizedDataUrl;
                        imgPreview.style.maxWidth = '100px';
                        imgPreview.style.marginRight = '5px';
                        imgPreview.onclick = function() {
                            const modal = document.querySelector('.modal');
                            const modalImg = document.querySelector('.modal-content');
                            modal.style.display = 'block';
                            modalImg.src = resizedDataUrl;
                        };

                        input.appendChild(imgPreview);
                    };
                };
                reader.onerror = function() {
                    Swal.fire('é”™è¯¯', 'è¯»å–å›¾ç‰‡å¤±è´¥', 'error');
                };
                reader.readAsDataURL(blob);
                e.preventDefault();
            }
        }

        if (!imageFound) {
            Swal.fire('æç¤º', 'æœªæ£€æµ‹åˆ°å‰ªåˆ‡æ¿ä¸­çš„å›¾ç‰‡', 'info');
        }
    });

    // å°çª—å£èŠå¤©æµ®çª—
    let isDragging = false;
    let offsetX, offsetY;

    function openChatFloatWindow() {
        document.getElementById('chatFloatWindow').style.display = 'block';
    }

    function closeChatFloatWindow() {
        document.getElementById('chatFloatWindow').style.display = 'none';
    }

    document.getElementById('chatFloatWindow').querySelector('.header').addEventListener('mousedown', function(e) {
        isDragging = true;
        offsetX = e.clientX - document.getElementById('chatFloatWindow').offsetLeft;
        offsetY = e.clientY - document.getElementById('chatFloatWindow').offsetTop;
    });

    document.addEventListener('mousemove', function(e) {
        if (isDragging) {
            document.getElementById('chatFloatWindow').style.left = (e.clientX - offsetX) + 'px';
            document.getElementById('chatFloatWindow').style.top = (e.clientY - offsetY) + 'px';
        }
    });

    document.addEventListener('mouseup', function() {
        isDragging = false;
    });

    // æ·»åŠ è°ƒæ•´å¤§å°åŠŸèƒ½
    let isResizing = false;
    let resizeOffsetX, resizeOffsetY;

    document.getElementById('chatFloatWindow').addEventListener('mousedown', function(e) {
        if (e.target.classList.contains('resizer')) {
            isResizing = true;
            resizeOffsetX = e.clientX - document.getElementById('chatFloatWindow').offsetWidth;
            resizeOffsetY = e.clientY - document.getElementById('chatFloatWindow').offsetHeight;
        } else {
            isDragging = true;
            offsetX = e.clientX - document.getElementById('chatFloatWindow').offsetLeft;
            offsetY = e.clientY - document.getElementById('chatFloatWindow').offsetTop;
        }
    });

    document.addEventListener('mousemove', function(e) {
        if (isDragging) {
            document.getElementById('chatFloatWindow').style.left = (e.clientX - offsetX) + 'px';
            document.getElementById('chatFloatWindow').style.top = (e.clientY - offsetY) + 'px';
        } else if (isResizing) {
            document.getElementById('chatFloatWindow').style.width = (e.clientX - resizeOffsetX) + 'px';
            document.getElementById('chatFloatWindow').style.height = (e.clientY - resizeOffsetY) + 'px';
        }
    });

    document.addEventListener('mouseup', function() {
        isDragging = false;
        isResizing = false;
    });

    // æ·»åŠ è°ƒæ•´å¤§å°çš„å›¾æ ‡
    document.getElementById('chatFloatWindow').innerHTML += '<div class="resizer" style="position: absolute; bottom: 0; right: 0; width: 10px; height: 10px; background: #ccc; cursor: se-resize;"></div>';

    document.addEventListener('DOMContentLoaded', function() {
        // æ·»åŠ ç”»ä¸­ç”»æŒ‰é’®
        document.getElementById('chatFloatWindow').querySelector('.header').innerHTML += '<button onclick="togglePictureInPicture()">ç”»ä¸­ç”»</button>';
    });
</script>

<div id="loading" class="hidden">
    <div class="loader"></div>
    <p>æ­£åœ¨è¿æ¥æœåŠ¡å™¨...</p>
</div>
<div class="container">
    <!-- æˆ¿é—´é€‰æ‹©ç•Œé¢ -->
    <div id="roomPanel" class="panel">
        <h1>æ¬¢è¿æ¥åˆ°èŠå¤©å®¤</h1>
        <div class="tabs">
            <button class="tab active" onclick="showTab('create')">åˆ›å»ºæˆ¿é—´</button>
            <button class="tab" onclick="showTab('join')">åŠ å…¥æˆ¿é—´</button>
        </div>

        <!-- åˆ›å»ºæˆ¿é—´ -->
        <div id="createTab" class="tab-content active">
            <input type="text" id="usernameCreate" placeholder="ä½ çš„æ˜µç§°">
            <input type="password" id="roomPassword" placeholder="æˆ¿é—´å¯†ç ï¼ˆå¯é€‰ï¼‰">
            <button onclick="createRoom()">åˆ›å»ºæ–°æˆ¿é—´</button>
        </div>

        <!-- åŠ å…¥æˆ¿é—´ -->
        <div id="joinTab" class="tab-content">
            <input type="text" id="usernameJoin" placeholder="ä½ çš„æ˜µç§°">
            <input type="text" id="roomId" placeholder="æˆ¿é—´IDï¼ˆ4ä½éšæœºå­—ç¬¦ï¼‰" maxlength="4">
            <input type="password" id="joinPassword" placeholder="æˆ¿é—´å¯†ç ï¼ˆå¦‚æœæœ‰ï¼‰">
            <button onclick="joinRoom()">åŠ å…¥æˆ¿é—´</button>
        </div>
    </div>

    <!-- èŠå¤©ç•Œé¢ -->
    <div id="chatPanel" class="panel hidden">
        <div class="room-info">
            <span>æˆ¿é—´ID: <span id="currentRoom">----</span></span>
            <span>å½“å‰ç”¨æˆ·: <span id="currentUsers">----</span></span>
            <button onclick="leaveRoom()">åˆ‡æ¢æˆ¿é—´</button>
            <button onclick="toggleDarkMode()" id="darkModeButton">ç™½å¤©æ¨¡å¼</button>
        </div>

        <div id="messages"></div>

        <div class="input-group">
            <div id="messageInput" contenteditable="true" placeholder="è¾“å…¥æ¶ˆæ¯ï¼ŒæŒ‰Enterå‘é€" onkeydown="handleKeyPress(event)"></div>
            <button onclick="sendMessage()">å‘é€</button>
            <button onclick="showEmojisPanel()">è¡¨æƒ…</button>
        </div>
    </div>

    <!-- è¡¨æƒ…é€‰æ‹©é¢æ¿ -->
    <div id="emojisPanel" class="hidden">
        <div class="emoji-list">
            <button onclick="insertEmoji('ğŸ˜Š')">ğŸ˜Š</button>
            <button onclick="insertEmoji('ğŸ˜‚')">ğŸ˜‚</button>
            <button onclick="insertEmoji('ğŸ˜')">ğŸ˜</button>
            <button onclick="insertEmoji('ğŸ˜')">ğŸ˜</button>
            <button onclick="insertEmoji('ğŸ˜¢')">ğŸ˜¢</button>
            <button onclick="insertEmoji('ğŸ˜­')">ğŸ˜­</button>
            <button onclick="insertEmoji('ğŸ¤”')">ğŸ¤”</button>
            <button onclick="insertEmoji('ğŸ‘')">ğŸ‘</button>
            <button onclick="insertEmoji('ğŸ‘')">ğŸ‘</button>
            <button onclick="insertEmoji('ğŸ‘')">ğŸ‘</button>
            <button onclick="insertEmoji('ğŸ™Œ')">ğŸ™Œ</button>
            <button onclick="insertEmoji('ğŸ‘‹')">ğŸ‘‹</button>
        </div>
    </div>

    <!-- å°çª—å£èŠå¤©æµ®çª— -->
    <div id="chatFloatWindow">
        <div class="header">èŠå¤©æµ®çª— <button onclick="closeChatFloatWindow()">å…³é—­</button></div>
        <div class="messages"></div>
        <div class="input-group">
            <div id="floatMessageInput" contenteditable="true" placeholder="è¾“å…¥æ¶ˆæ¯ï¼ŒæŒ‰Enterå‘é€" onkeydown="handleKeyPress(event)" style="min-height: 50px; padding: 5px; border: 1px solid #ccc; border-radius: 25px;"></div>
            <button onclick="sendMessageFromFloat()">å‘é€</button>
        </div>
    </div>

</div>

</body>
</html>